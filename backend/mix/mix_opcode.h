#pragma once

#include <cstdint>

#include "backend/mix/mix_item.h"

namespace Mix {

enum class Opcode : uint8_t {
    NOP = 0,
    ADD = 1,
    FADD = 1,
    SUB = 2,
    FSUB = 2,
    MUL = 3,
    FMUL = 3,
    DIV = 4,
    FDIV = 4,
    NUM = 5,
    CHAR = 5,
    HLT = 5,
    SLA = 6,
    SRA = 6,
    SLAX = 6,
    SRAX = 6,
    SLC = 6,
    SRC = 6,
    MOVE = 7,
    LDA = 8,
    LD1 = 9,
    LD2 = 10,
    LD3 = 11,
    LD4 = 12,
    LD5 = 13,
    LD6 = 14,
    LDX = 15,
    LDAN = 16,
    LD1N = 17,
    LD2N = 18,
    LD3N = 19,
    LD4N = 20,
    LD5N = 21,
    LD6N = 22,
    LDXN = 23,
    STA = 24,
    ST1 = 25,
    ST2 = 26,
    ST3 = 27,
    ST4 = 28,
    ST5 = 29,
    ST6 = 30,
    STX = 31,
    STJ = 32,
    STZ = 33,
    JBUS = 34,
    IOC = 35,
    IN = 36,
    OUT = 37,
    JRED = 38,
    JMP = 39,
    JSJ = 39,
    JOV = 39,
    JNOV = 39,
    JL = 39,
    JE = 39,
    JG = 39,
    JGE = 39,
    JNE = 39,
    JLE = 39,
    JAN = 40,
    JAZ = 40,
    JAP = 40,
    JANN = 40,
    JANZ = 40,
    JANP = 40,
    J1N = 41,
    J1Z = 41,
    J1P = 41,
    J1NN = 41,
    J1NZ = 41,
    J1NP = 41,
    J2N = 42,
    J2Z = 42,
    J2P = 42,
    J2NN = 42,
    J2NZ = 42,
    J2NP = 42,
    J3N = 43,
    J3Z = 43,
    J3P = 43,
    J3NN = 43,
    J3NZ = 43,
    J3NP = 43,
    J4N = 44,
    J4Z = 44,
    J4P = 44,
    J4NN = 44,
    J4NZ = 44,
    J4NP = 44,
    J5N = 45,
    J5Z = 45,
    J5P = 45,
    J5NN = 45,
    J5NZ = 45,
    J5NP = 45,
    J6N = 46,
    J6Z = 46,
    J6P = 46,
    J6NN = 46,
    J6NZ = 46,
    J6NP = 46,
    JXN = 47,
    JXZ = 47,
    JXP = 47,
    JXNN = 47,
    JXNZ = 47,
    JXNP = 47,
    INCA = 48,
    DECA = 48,
    ENTA = 48,
    ENNA = 48,
    INC1 = 49,
    DEC1 = 49,
    ENT1 = 49,
    ENN1 = 49,
    INC2 = 50,
    DEC2 = 50,
    ENT2 = 50,
    ENN2 = 50,
    INC3 = 51,
    DEC3 = 51,
    ENT3 = 51,
    ENN3 = 51,
    INC4 = 52,
    DEC4 = 52,
    ENT4 = 52,
    ENN4 = 52,
    INC5 = 53,
    DEC5 = 53,
    ENT5 = 53,
    ENN5 = 53,
    INC6 = 54,
    DEC6 = 54,
    ENT6 = 54,
    ENN6 = 54,
    INCX = 55,
    DECX = 55,
    ENTX = 55,
    ENNX = 55,
    CMPA = 56,
    FCMP = 56,
    CMP1 = 57,
    CMP2 = 58,
    CMP3 = 59,
    CMP4 = 60,
    CMP5 = 61,
    CMP6 = 62,
    CMPX = 63,
};

enum class Index : uint8_t {
    None = 0,
    I1 = 1,
    I2 = 2,
    I3 = 3,
    I4 = 4,
    I5 = 5,
    I6 = 6,
};

constexpr Opcode operator+(Opcode op, Index offset) {
    const int result{static_cast<int>(op) + static_cast<int>(offset)};
    return static_cast<Opcode>(result);
}

constexpr Word Encode(Short address, Index index, uint8_t field, Opcode opcode) {
    const uint32_t inst = address.Raw() << 18 | uint32_t(index) << 12 | field << 6 | uint32_t(opcode);
    return inst;
}

} // namespace Mix